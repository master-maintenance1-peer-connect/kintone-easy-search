(()=>{"use strict";var e={RECORD_NUMBER:{name:"レコード番号",type:"RECORD_NUMBER"},MODIFIER:{name:"更新者",type:"MODIFIER"},CREATOR:{name:"作成者",type:"CREATOR"},UPDATED_TIME:{name:"更新日時",type:"UPDATED_TIME"},CREATED_TIME:{name:"作成日時",type:"CREATED_TIME"},STATUS:{name:"ステータス",type:"STATUS"},STATUS_ASSIGNEE:{name:"作業者",type:"STATUS_ASSIGNEE"},CATEGORY:{name:"カテゴリー",type:"CATEGORY"},SINGLE_LINE_TEXT:{name:"文字列 (1行)",type:"SINGLE_LINE_TEXT"},RICH_TEXT:{name:"リッチエディター",type:"RICH_TEXT"},MULTI_LINE_TEXT:{name:"文字列 (複数行)",type:"MULTI_LINE_TEXT"},NUMBER:{name:"数値",type:"NUMBER"},CALC:{name:"計算",type:"CALC"},RADIO_BUTTON:{name:"ラジオボタン",type:"RADIO_BUTTON"},CHECK_BOX:{name:"チェックボックス",type:"CHECK_BOX"},MULTI_SELECT:{name:"複数選択",type:"MULTI_SELECT"},DROP_DOWN:{name:"ドロップダウン",type:"DROP_DOWN"},DATE:{name:"日付",type:"DATE"},TIME:{name:"時刻",type:"TIME"},DATETIME:{name:"日時",type:"DATETIME"},FILE:{name:"添付ファイル",type:"FILE"},LINK:{name:"リンク",type:"LINK"},USER_SELECT:{name:"ユーザー選択",type:"USER_SELECT"},GROUP_SELECT:{name:"グループ選択",type:"GROUP_SELECT"},ORGANIZATION_SELECT:{name:"組織選択",type:"ORGANIZATION_SELECT"},REFERENCE_TABLE:{name:"関連レコード一覧",type:"REFERENCE_TABLE"},SUBTABLE:{name:"テーブル",type:"SUBTABLE"},GROUP:{name:"グループ",type:"GROUP"}};const t='<div class="kintoneplugin-input-checkbox"> <span class="kintoneplugin-input-checkbox-item"> <input type="checkbox" name="checkbox" id=""> <label for=""></label> </span> </div>';function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,o=function(){};return{s:o,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function a(e,t,n,r,a,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(r,a)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function c(e){a(i,r,o,c,l,"next",e)}function l(e){a(i,r,o,c,l,"throw",e)}c(void 0)}))}}var i=kintone.$PLUGIN_ID,c=kintone.app.getId(),l=kintone.plugin.app.getConfig(i);l.fields=l.fields?JSON.parse(l.fields):[];var p=["SINGLE_LINE_TEXT","MULTI_LINE_TEXT","RICH_TEXT","LINK","NUMBER","CHECK_BOX","RADIO_BUTTON","DROP_DOWN","MULTI_SELECT"],u={search:"_INPUT_",searchPlaceholder:"検索",zeroRecords:"データがありません。"},s={};function d(e){var t=String(e);return s[t]||(s[t]=kintone.api("/k/v1/app/form/fields","GET",{app:e}).then((function(e){return e.properties})).catch((function(){return{}}))),s[t]}function f(){return T.apply(this,arguments)}function T(){return(T=o(regeneratorRuntime.mark((function e(){var t,r,a,o,i,l,u,s,f,T,E,b,y,h,m,_,g,I,R,C,O,v,k,L,A,N,S,U,D,x,w,B,M;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kintone.api("/k/v1/preview/app/form/fields","GET",{app:c});case 2:return t=e.sent,r=t.properties,e.next=6,kintone.api("/k/v1/preview/app/form/layout","GET",{app:c});case 6:a=e.sent,o=a.layout,i=[],function e(t){var r,a=n(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;if("ROW"===o.type){var c,l=n(o.fields);try{for(l.s();!(c=l.n()).done;){var p=c.value.code;p&&i.push(p)}}catch(e){l.e(e)}finally{l.f()}}else"SUBTABLE"===o.type?i.push(o.code):"GROUP"===o.type&&e(o.layout)}}catch(e){a.e(e)}finally{a.f()}}(o),l=[],u=0,s=i;case 12:if(!(u<s.length)){e.next=37;break}if(f=s[u],T=r[f],E=T.type,b=T.label,y=T.options,"SUBTABLE"!==E){e.next=21;break}for(h={code:f},m=0,_=Object.values(T.fields);m<_.length;m++)g=_[m],I=g.code,R=g.type,C=g.label,O=g.options,l.push({code:I,type:R,label:C,options:O,subTable:h}),!O&&["CHECK_BOX","RADIO_BUTTON","DROP_DOWN","MULTI_SELECT"].includes(R)&&console.error("実装不備! optionsが未定義 "+R);e.next=34;break;case 21:if("REFERENCE_TABLE"!==E){e.next=32;break}if(!T.referenceTable){e.next=30;break}return v=T.referenceTable,k=v.displayFields,L=v.relatedApp,A={code:f,label:b,app:L.app},e.next=27,d(L.app);case 27:N=e.sent,S=n(k);try{for(S.s();!(U=S.n()).done;)D=U.value,N[D]&&(x=N[D].type,w=N[D].label,B=N[D].options,M={code:D,type:x,label:w,options:B,referenceTable:A},l.push(M)),N[D]&&!y&&["CHECK_BOX","RADIO_BUTTON","DROP_DOWN","MULTI_SELECT"].includes(N[D].type)&&console.error("実装不備! optionsが未定義 "+T.type+" "+N[D].type)}catch(e){S.e(e)}finally{S.f()}case 30:e.next=34;break;case 32:l.push({code:f,type:E,label:b,options:y}),!y&&["CHECK_BOX","RADIO_BUTTON","DROP_DOWN","MULTI_SELECT"].includes(E)&&console.error("実装不備! optionsが未定義 "+E);case 34:u++,e.next=12;break;case 37:return e.abrupt("return",l.filter((function(e){var t=e.type;return p.includes(t)})));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o(regeneratorRuntime.mark((function n(){var r,a,o,i,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return new Vue({el:"#config",data:{},methods:{submit:function(){for(var e=$("#fields").DataTable(),t=[],n=0;n<e.data().count();n++){var r=e.row(n),a=r.data(),o=r.node();$(".kintoneplugin-input-checkbox",o).find("input").prop("checked")&&t.push(a)}kintone.plugin.app.setConfig({fields:JSON.stringify(t)})},cancel:function(){history.back()}}}),n.next=3,f();case 3:for(r=n.sent,a=$("#fields").DataTable({language:u,data:r,columnDefs:[{targets:0,title:"",data:null,orderable:!1,defaultContent:t,width:"5%"},{targets:1,title:"インデックス",data:function(e){return r.indexOf(e)},defaultContent:"",visible:!1},{targets:2,title:"フィールド名",data:"label",defaultContent:"",width:"35%",orderable:!1},{targets:3,title:"フィールドコード",data:"code",defaultContent:"",orderable:!1,visible:!1},{targets:4,title:"フィールド種類",data:function(t){return e[t.type].name},defaultContent:"",width:"25%",orderable:!1},{targets:5,title:"テーブル・関連レコード一覧",data:function(e){return e.subTable?e.subTable.code:e.referenceTable?e.referenceTable.label:""},defaultContent:"",width:"35%",orderable:!1}],scrollY:"400px",scrollCollapse:!0,paging:!1,order:[[1,"asc"]],info:!1,searching:!0,createdRow:function(e,t,n){var r=$(".kintoneplugin-input-checkbox",e);r.find("input").attr("id","checkbox-".concat(n)).on("change",(function(t){$(t.target).prop("checked")?$(e).addClass("selected"):$(e).removeClass("selected")})),r.find("label").attr("for","checkbox-".concat(n))}}),$(window).resize((function(){var e=$(".dataTables_wrapper").width("100%"),t=document.body.scrollWidth-document.body.clientWidth;t>0&&e.width(e.width()-t)})),$(window).resize((function(){var e=$(".dataTables_scrollBody").css("maxHeight",document.body.clientHeight),t=document.body.scrollHeight-document.body.clientHeight;t>0&&e.css("maxHeight",e.height()-t-5)})),$(window).resize((function(){a.columns.adjust().draw()})),setTimeout((function(){return $(window).resize()})),(o=$(t).appendTo(a.column(0).header())).find("input").attr("id","checkbox-all").on("change",(function(e){$(e.target).prop("checked")?$(".kintoneplugin-input-checkbox").find("input:not(#checkbox-all)").prop("checked",!0).trigger("change"):$(".kintoneplugin-input-checkbox").find("input:not(#checkbox-all)").prop("checked",!1).trigger("change")})),o.find("label").attr("for","checkbox-all"),a.on("search",(function(){o.find("input").prop("checked",!1)})),i=function(e){var t=a.row(e),n=t.data(),r=t.node(),o=n.code,i=n.type,c=n.subTable,p=void 0===c?{}:c,u=n.referenceTable,s=void 0===u?{}:u;l.fields.findIndex((function(e){return e.code===o&&e.type===i&&(e.subTable||{}).code===p.code&&(e.referenceTable||{}).code===s.code&&(e.referenceTable||{}).app===s.app}))>-1&&$(".kintoneplugin-input-checkbox",r).find("input").prop("checked",!0).trigger("change")},c=0;c<a.data().count();c++)i(c);case 15:case"end":return n.stop()}}),n)})))()})();