(()=>{"use strict";var e={RECORD_NUMBER:{name:"レコード番号",type:"RECORD_NUMBER"},MODIFIER:{name:"更新者",type:"MODIFIER"},CREATOR:{name:"作成者",type:"CREATOR"},UPDATED_TIME:{name:"更新日時",type:"UPDATED_TIME"},CREATED_TIME:{name:"作成日時",type:"CREATED_TIME"},STATUS:{name:"ステータス",type:"STATUS"},STATUS_ASSIGNEE:{name:"作業者",type:"STATUS_ASSIGNEE"},CATEGORY:{name:"カテゴリー",type:"CATEGORY"},SINGLE_LINE_TEXT:{name:"文字列 (1行)",type:"SINGLE_LINE_TEXT"},RICH_TEXT:{name:"リッチエディター",type:"RICH_TEXT"},MULTI_LINE_TEXT:{name:"文字列 (複数行)",type:"MULTI_LINE_TEXT"},NUMBER:{name:"数値",type:"NUMBER"},CALC:{name:"計算",type:"CALC"},RADIO_BUTTON:{name:"ラジオボタン",type:"RADIO_BUTTON"},CHECK_BOX:{name:"チェックボックス",type:"CHECK_BOX"},MULTI_SELECT:{name:"複数選択",type:"MULTI_SELECT"},DROP_DOWN:{name:"ドロップダウン",type:"DROP_DOWN"},DATE:{name:"日付",type:"DATE"},TIME:{name:"時刻",type:"TIME"},DATETIME:{name:"日時",type:"DATETIME"},FILE:{name:"添付ファイル",type:"FILE"},LINK:{name:"リンク",type:"LINK"},USER_SELECT:{name:"ユーザー選択",type:"USER_SELECT"},GROUP_SELECT:{name:"グループ選択",type:"GROUP_SELECT"},ORGANIZATION_SELECT:{name:"組織選択",type:"ORGANIZATION_SELECT"},REFERENCE_TABLE:{name:"関連レコード一覧",type:"REFERENCE_TABLE"},SUBTABLE:{name:"テーブル",type:"SUBTABLE"},GROUP:{name:"グループ",type:"GROUP"}};const t='<div class="kintoneplugin-input-checkbox"> <span class="kintoneplugin-input-checkbox-item"> <input type="checkbox" name="checkbox" id=""> <label for=""></label> </span> </div>';function n(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,c=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return c=e.done,e},e:function(e){l=!0,i=e},f:function(){try{c||null==n.return||n.return()}finally{if(l)throw i}}}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function r(e,t,n,a,r,o,i){try{var c=e[o](i),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,o){var i=e.apply(t,n);function c(e){r(i,a,o,c,l,"next",e)}function l(e){r(i,a,o,c,l,"throw",e)}c(void 0)}))}}var i=kintone.$PLUGIN_ID,c=kintone.app.getId(),l=kintone.plugin.app.getConfig(i);l.fields=l.fields?JSON.parse(l.fields):[];var p=["SINGLE_LINE_TEXT","MULTI_LINE_TEXT","RICH_TEXT","LINK","NUMBER","CHECK_BOX","RADIO_BUTTON","DROP_DOWN","MULTI_SELECT"],u={search:"_INPUT_",searchPlaceholder:"検索",zeroRecords:"データがありません。"},d={};function s(e){var t=String(e);return d[t]||(d[t]=kintone.api("/k/v1/app/form/fields","GET",{app:e}).then((function(e){return e.properties})).catch((function(){return{}}))),d[t]}function f(){return E.apply(this,arguments)}function E(){return(E=o(regeneratorRuntime.mark((function e(){var t,a,r,o,i,l,u,d,f,E,T,b,h,y,m,g,v,I,R,k,_,C,A,L,O,S,N,x,w,U,D,B,M;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kintone.api("/k/v1/preview/app/form/fields","GET",{app:c});case 2:return t=e.sent,a=t.properties,e.next=6,kintone.api("/k/v1/preview/app/form/layout","GET",{app:c});case 6:r=e.sent,o=r.layout,i=[],function e(t){var a,r=n(t);try{for(r.s();!(a=r.n()).done;){var o=a.value;if("ROW"===o.type){var c,l=n(o.fields);try{for(l.s();!(c=l.n()).done;){var p=c.value.code;p&&i.push(p)}}catch(e){l.e(e)}finally{l.f()}}else"SUBTABLE"===o.type?i.push(o.code):"GROUP"===o.type&&e(o.layout)}}catch(e){r.e(e)}finally{r.f()}}(o),l=[],u=0,d=i;case 12:if(!(u<d.length)){e.next=36;break}if(f=d[u],E=a[f],T=E.type,b=E.label,h=E.options,"SUBTABLE"!==T){e.next=21;break}for(y={code:f},m=0,g=Object.values(E.fields);m<g.length;m++)v=g[m],I=v.code,R=v.type,k=v.label,_=v.options,l.push({code:I,type:R,label:k,options:_,subTable:y});e.next=33;break;case 21:if("REFERENCE_TABLE"!==T){e.next=32;break}if(!E.referenceTable){e.next=30;break}return C=E.referenceTable,A=C.displayFields,L=C.relatedApp,O={code:f,label:b,app:L.app},e.next=27,s(L.app);case 27:S=e.sent,N=n(A);try{for(N.s();!(x=N.n()).done;)w=x.value,S[w]&&(U=S[w].type,D=S[w].label,B=S[w].options,M={code:w,type:U,label:D,options:B,referenceTable:O},l.push(M))}catch(e){N.e(e)}finally{N.f()}case 30:e.next=33;break;case 32:l.push({code:f,type:T,label:b,options:h});case 33:u++,e.next=12;break;case 36:return e.abrupt("return",l.filter((function(e){var t=e.type;return p.includes(t)})));case 37:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o(regeneratorRuntime.mark((function n(){var a,r,o,i,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return new Vue({el:"#config",data:{},methods:{submit:function(){for(var e=$("#fields").DataTable(),t=[],n=0;n<e.data().count();n++){var a=e.row(n),r=a.data(),o=a.node();$(".kintoneplugin-input-checkbox",o).find("input").prop("checked")&&t.push(r)}kintone.plugin.app.setConfig({fields:JSON.stringify(t)})},cancel:function(){history.back()}}}),n.next=3,f();case 3:for(a=n.sent,r=$("#fields").DataTable({language:u,data:a,columnDefs:[{targets:0,title:"",data:null,orderable:!1,defaultContent:t,width:"5%"},{targets:1,title:"インデックス",data:function(e){return a.indexOf(e)},defaultContent:"",visible:!1},{targets:2,title:"フィールド名",data:"label",defaultContent:"",width:"35%",orderable:!1},{targets:3,title:"フィールドコード",data:"code",defaultContent:"",orderable:!1,visible:!1},{targets:4,title:"フィールド種類",data:function(t){return e[t.type].name},defaultContent:"",width:"25%",orderable:!1},{targets:5,title:"テーブル・関連レコード一覧",data:function(e){return e.subTable?e.subTable.code:e.referenceTable?e.referenceTable.label:""},defaultContent:"",width:"35%",orderable:!1}],scrollY:"400px",scrollCollapse:!0,paging:!1,order:[[1,"asc"]],info:!1,searching:!0,createdRow:function(e,t,n){var a=$(".kintoneplugin-input-checkbox",e);a.find("input").attr("id","checkbox-".concat(n)).on("change",(function(t){$(t.target).prop("checked")?$(e).addClass("selected"):$(e).removeClass("selected")})),a.find("label").attr("for","checkbox-".concat(n))}}),$(window).resize((function(){var e=$(".dataTables_wrapper").width("100%"),t=document.body.scrollWidth-document.body.clientWidth;t>0&&e.width(e.width()-t)})),$(window).resize((function(){var e=$(".dataTables_scrollBody").css("maxHeight",document.body.clientHeight),t=document.body.scrollHeight-document.body.clientHeight;t>0&&e.css("maxHeight",e.height()-t-5)})),$(window).resize((function(){r.columns.adjust().draw()})),setTimeout((function(){return $(window).resize()})),(o=$(t).appendTo(r.column(0).header())).find("input").attr("id","checkbox-all").on("change",(function(e){$(e.target).prop("checked")?$(".kintoneplugin-input-checkbox").find("input:not(#checkbox-all)").prop("checked",!0).trigger("change"):$(".kintoneplugin-input-checkbox").find("input:not(#checkbox-all)").prop("checked",!1).trigger("change")})),o.find("label").attr("for","checkbox-all"),r.on("search",(function(){o.find("input").prop("checked",!1)})),i=function(e){var t=r.row(e),n=t.data(),a=t.node(),o=n.code,i=n.type,c=n.subTable,p=void 0===c?{}:c,u=n.referenceTable,d=void 0===u?{}:u;l.fields.findIndex((function(e){return e.code===o&&e.type===i&&(e.subTable||{}).code===p.code&&(e.referenceTable||{}).code===d.code&&(e.referenceTable||{}).app===d.app}))>-1&&$(".kintoneplugin-input-checkbox",a).find("input").prop("checked",!0).trigger("change")},c=0;c<r.data().count();c++)i(c);case 15:case"end":return n.stop()}}),n)})))()})();